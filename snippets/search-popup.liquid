{% liquid

%}
<button class="open-button">
  Search for your vehicle
  <img
    src="https://cdn.shopify.com/s/files/1/0620/4565/1108/files/car-white.png?v=1678531498"
    width="25"
    height="25"
    |
    img_url
  >
</button>

<div id="dialog-wrapper">
  <dialog class="modales">
    <section class="search-bar">
      <form action="{{ routes.search_url }}">
        <select
          id="slct1"
          name="slct1"
          onchange="populate(this.id,'slct2')"
        >
          <option value="-Make-">Make</option>
          <option value="Tesla">Tesla</option>
          <option value="Peugeot">Peugeot</option>
          <option value="Mini">Mini</option>
          <option value="Dacia">Dacia</option>
          <option value="Mercedes">Mercedes</option>
          <option value="Audi">Audi</option>
        </select>

        <select
          id="slct2"
          disabled
          name="slct2"
        >
          <option value="-Make-">Model</option>
        </select>

        <select
          id="year"
          disabled
          onChange="update()"
        >
          <option value="en">Year</option>
          <option value="en">2018</option>
          <option value="es">2019</option>
          <option value="ey">2020</option>
          <option value="er">2021</option>
          <option value="eu">2022</option>
          <option value="eu">2023</option>
        </select>
        <input
          type="text"
          placeholder="Search"
          name="q"
          id="text"
          class="text-bar"
          disabled
        >
        <input
          class="shop-car-button"
          type="submit"
          value="Shop by car"
        >
      </form>
      <svg
        class="close"
        width="15"
        height="15"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path d="M11.314 0l2.828 2.828L9.9 7.071l4.243 4.243-2.828 2.828L7.07 9.9l-4.243 4.243L0 11.314 4.242 7.07 0 2.828 2.828 0l4.243 4.242L11.314 0z" fill="#000" fill-rule="evenodd" opacity=".4"/>
      </svg>
    </section>
  </dialog>
</div>
{% liquid

%}

{% style %}
  .open-button {
      width: 100%;
      padding: 0.9em;
      background-color: #194ba0;
      color: #fff;
      font-weight: 600;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto;
      gap: 1em;
      font-size:1em;
  }

  .open-button:hover {
      filter: brightness(1.2)
  }

  .search-bar {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 30px;
      margin-bottom: 30px;

  }

  .search-bar input {
  padding: 1em;
  appearance: none;
  }

  .search-bar select {
    appearance:none;
  padding: 1em;
  }

  .shop-car-button {
      background-color: #e32020;
      border: none;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
  }

      dialog {
      border: none;
      position: fixed;
      top: 0;
      left: 0;
  }

      .modales::backdrop {
      background: rgb(0 0 0 / 0.4);
    }

    .close {
      position: absolute;
      top: 0;
      bottom: 0;
      top: 1em;
      right: 1em;
      cursor: pointer;
    }

    @media(max-width: 800px) {
    .search-bar form {
      display: flex;
      flex-direction: column;
      gap: 2em;
      width: 100%;
      padding: 2em;
    }
  }
{% endstyle %}

<script>
  {% comment %} modal {% endcomment %}
    const dialog = document.querySelector('dialog')
    const openModal = document.querySelector(".open-button");
    const closeModal = document.querySelector(".close");

    openModal.addEventListener('click', () => {
      dialog.showModal()
    })

    closeModal.addEventListener('click', () => {
      dialog.close()
    })

    {% comment %} Car-filter {% endcomment %}

    function populate(s1, s2) {
        var s1 = document.getElementById(s1);
        var s2 = document.getElementById(s2);
        var s3 = document.getElementById('year');
        var text = document.getElementById('text');
        s2.innerHTML = '';
        s2.removeAttribute('disabled');
        s3.removeAttribute('disabled');
        text.removeAttribute('disabled');
        if (s1.value == 'Tesla') {
          var optionArray = ['|Model', 'model y|Model Y', 'model 3|Model 3', 'Tesla Y Sunshade|tesla y sunshade'];
        } else if (s1.value == 'Dacia') {
          var optionArray = ['|Model', 'duster|Duster'];
        } else if (s1.value == 'Mini') {
          var optionArray = ['|Model', 'clubman|Clubman', 'countryman|Countryman'];
        } else if (s1.value == 'Peugeot') {
          var optionArray = ['|Model', '3008|3008'];
        } else if (s1.value == 'Audi') {
          var optionArray = [
            '|Model',
            'e-tron gt cargo|E-tron GT Cargo',
            'e-tron|E-tron ',
            'e-tron suv' | 'E-tron SUV'
          ];
        } else if (s1.value == 'Mercedes') {
          var optionArray = ['|Model', 'g-class|G-class'];
        }
        for (var option in optionArray) {
          var pair = optionArray[option].split('|');
          var newOption = document.createElement('option');
          newOption.value = pair[0];
          newOption.innerHTML = pair[1];
          s2.options.add(newOption);
        }
      }

      function update() {
        var make = document.getElementById('slct1');
        var optionMake = make.options[make.selectedIndex];

        var model = document.getElementById('slct2');
        var optionModel = model.options[model.selectedIndex];

        var year = document.getElementById('year');
        var optionYear = year.options[year.selectedIndex];

        document.getElementById('text').value = optionMake.text + ' ' + optionModel.text + ' ' + optionYear.text;
      }
</script>
